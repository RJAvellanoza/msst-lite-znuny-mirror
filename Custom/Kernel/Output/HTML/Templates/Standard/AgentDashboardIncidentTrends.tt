# --
# Copyright (C) 2025 MSST, https://msst.com/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --

<div class="DashboardIncidentTrends">
    <h3>[% Translate("30-Day Incident Trends") | html %]</h3>

[% RenderBlockStart("TrendChart") %]
    <div class="TrendSummary">
        <span class="TotalLabel">[% Translate("Total incidents (30 days):") | html %]</span>
        <span class="TotalValue">[% Data.TotalIncidents | html %]</span>
    </div>

    <div class="TrendChartContainer">
        <div class="ChartBarContainer">
[% RenderBlockStart("TrendDay") %]
            <div class="ChartBarDay" title="[% Data.Date | html %]: [% Data.Count | html %] incidents (P1: [% Data.P1 | html %], P2: [% Data.P2 | html %], P3: [% Data.P3 | html %], P4: [% Data.P4 | html %])">
                <div class="ChartBar">
                    <div class="BarFill" style="height: [% Data.PercentHeight | html %]%;"></div>
                </div>
                <div class="BarLabel" title="[% Data.Date | html %]">
                    <small>[% Data.Date.substr(5, 5) | html %]</small>
                </div>
                <div class="BarCount">[% Data.Count | html %]</div>
            </div>
[% RenderBlockEnd("TrendDay") %]
        </div>
    </div>

    <div class="LegendContainer">
        <h4>[% Translate("Priority Legend") | html %]</h4>
        <ul class="LegendList">
            <li><span class="LegendColor P1"></span> [% Translate("P1 - Critical") | html %]</li>
            <li><span class="LegendColor P2"></span> [% Translate("P2 - High") | html %]</li>
            <li><span class="LegendColor P3"></span> [% Translate("P3 - Medium") | html %]</li>
            <li><span class="LegendColor P4"></span> [% Translate("P4 - Low") | html %]</li>
        </ul>
    </div>

[% RenderBlockEnd("TrendChart") %]

[% RenderBlockStart("NoData") %]
    <p class="NoDataMessage">[% Translate("No incident trend data available for the last 30 days.") | html %]</p>
[% RenderBlockEnd("NoData") %]

</div>

<style>
    .DashboardIncidentTrends {
        padding: 15px;
    }

    .DashboardIncidentTrends h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #333;
    }

    .DashboardIncidentTrends h4 {
        margin-top: 15px;
        margin-bottom: 10px;
        font-size: 0.95em;
        color: #444;
    }

    .TrendSummary {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        padding: 10px;
        background-color: #f0f0f0;
        border-radius: 4px;
    }

    .TotalLabel {
        color: #666;
        font-weight: 500;
    }

    .TotalValue {
        font-size: 1.5em;
        font-weight: bold;
        color: #0066cc;
    }

    .TrendChartContainer {
        margin-bottom: 20px;
        padding: 10px 0;
        border-bottom: 1px solid #ddd;
    }

    .ChartBarContainer {
        display: flex;
        align-items: flex-end;
        justify-content: space-around;
        height: 200px;
        gap: 2px;
        background-color: #fafafa;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #e0e0e0;
    }

    .ChartBarDay {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
        height: 100%;
        cursor: pointer;
    }

    .ChartBarDay:hover {
        opacity: 0.8;
    }

    .ChartBar {
        width: 100%;
        height: calc(100% - 40px);
        display: flex;
        align-items: flex-end;
        border-radius: 2px 2px 0 0;
        background-color: #f0f0f0;
        border: 1px solid #ddd;
        min-height: 10px;
    }

    .BarFill {
        width: 100%;
        background: linear-gradient(to top, #4a90e2, #7ab3ff);
        border-radius: 2px 2px 0 0;
        min-height: 2px;
        transition: background-color 0.3s ease;
    }

    .ChartBarDay:hover .BarFill {
        background: linear-gradient(to top, #2870c2, #5a93d2);
    }

    .BarLabel {
        flex: 1;
        text-align: center;
        font-size: 0.75em;
        color: #999;
        margin-top: 4px;
        white-space: nowrap;
    }

    .BarCount {
        font-size: 0.8em;
        font-weight: bold;
        color: #666;
        margin-top: 2px;
    }

    .LegendContainer {
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #e0e0e0;
    }

    .LegendList {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .LegendList li {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9em;
    }

    .LegendColor {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 2px;
    }

    .LegendColor.P1 {
        background-color: #d32f2f;
    }

    .LegendColor.P2 {
        background-color: #f57c00;
    }

    .LegendColor.P3 {
        background-color: #fbc02d;
    }

    .LegendColor.P4 {
        background-color: #1976d2;
    }

    .NoDataMessage {
        padding: 30px;
        background-color: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 4px;
        color: #856404;
        text-align: center;
    }
</style>
